# TestSpecAnalyticsCLI 要件定義書

## 1. 概要

既存の`ReadData.py`モジュールを基に、Windowsコマンドラインで実行可能なCLIツールを開発します。Excelファイル（.xlsx）からテスト結果データを読み取り、集計結果をコンソールに表示するツールです。

## 2. 基本機能

### 2.1 コア機能
- Excelファイル（.xlsx）の読み取り
- `ReadData.py`と同じロジックによるデータ集計
- 集計結果のコンソール表示（テーブル形式）
- JSON形式での出力オプション
- 複数ファイル処理時の統合集計機能（SUMMARY TOTAL RESULTS）

### 2.2 ファイル処理オプション
- 単一ファイル処理：指定されたxlsxファイルを処理
- フォルダ一括処理：指定されたフォルダ内の全xlsxファイルを処理

## 3. コマンドライン仕様

### 3.1 基本コマンド形式
```bash
python test_spec_analytics.py [オプション] [ファイルパス/フォルダパス]
```

### 3.2 オプション一覧
| オプション | 短縮形 | 説明 | デフォルト値 |
|------------|--------|------|--------------|
| `--config` | `-c` | 設定ファイルのパス | `config.json` |
| `--output-format` | `-f` | 出力形式（table/json/csv/excel） | `table` |
| `--output-file` | `-o` | 出力ファイルパス | なし（コンソール出力のみ） |
| `--json-output` | `-j` | JSON形式で出力 | `false` |
| `--verbose` | `-v` | 詳細ログ出力（ファイル処理・データ集計の進捗や内部情報を詳細に表示） | `false` |
| `--help` | `-h` | ヘルプ表示 | - |

### 3.3 使用例
```bash
# 単一ファイル処理（テーブル形式）
python test_spec_analytics.py sample1.xlsx

# 単一ファイル処理（JSON形式）
python test_spec_analytics.py -j sample1.xlsx

# フォルダ一括処理
python test_spec_analytics.py input_sample/

# カスタム設定ファイル使用
python test_spec_analytics.py -c custom_config.json sample1.xlsx

# 詳細ログ付き
python test_spec_analytics.py -v sample1.xlsx

# CSV形式でファイル出力
python test_spec_analytics.py -o results.csv sample1.xlsx

# Excel形式でファイル出力
python test_spec_analytics.py -o results.xlsx sample1.xlsx

# 複数ファイル処理でCSV出力
python test_spec_analytics.py -o summary.csv input_sample/
```

## 4. 設定ファイル仕様

### 4.1 設定ファイル形式
- JSON形式
- デフォルト：`config.json`（ツールと同じディレクトリ）
- カスタム設定ファイルも指定可能

### 4.2 設定項目
現在の`config.json`の構造をそのまま使用：
- `read_definition`: データ読み取り定義
- `test_status`: テストステータス定義

## 5. 出力仕様

### 5.1 テーブル形式出力

#### 単一ファイル処理の場合
```
==========================================
TestSpecAnalytics Results
==========================================

File: sample1.xlsx
Total Cases: 150
Available Cases: 145
Excluded Cases: 5

TOTAL RESULTS:
┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────────┬─────────────┐
│ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ Total   │ 完了数  │ 消化数  │ 完了率(%)   │ 消化率(%)   │
├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────────┼─────────────┤
│ 33      │ 1       │ 0       │ 0       │ 0       │ 9       │ 43      │ 100     │ 120     │ 68.97       │ 82.76       │
└─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────────┴─────────────┘

STATISTICS:
┌─────────────┬─────────┐
│ Metric      │ Count   │
├─────────────┼─────────┤
│ All         │ 150     │
│ Available   │ 145     │
│ Executed    │ 120     │
│ Completed   │ 100     │
│ Incompleted │ 25      │
│ Planned     │ 80      │
└─────────────┴─────────┘

STATUS: In Progress
Start Date: 2024-01-15
Last Update: 2024-01-20

DAILY BREAKDOWN:
┌────────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Date       │ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ 完了数  │ 消化数  │ 計画数  │
├────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ 2024-01-15 │ 10      │ 0       │ 2       │ 1       │ 0       │ 0       │ 13      │ 13      │ 20      │
│ 2024-01-16 │ 15      │ 0       │ 1       │ 0       │ 0       │ 0       │ 16      │ 16      │ 25      │
└────────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘

BY NAME:
┌────────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Date       │ 田中    │ 佐藤    │ 鈴木    │ 完了数  │ 消化数  │ 計画数  │
├────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ 2024-01-15 │ 8       │ 3       │ 2       │ 13      │ 13      │ 20      │
│ 2024-01-16 │ 10      │ 4       │ 2       │ 16      │ 16      │ 25      │
└────────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘

BY ENVIRONMENT:

セット1:
┌────────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Date       │ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ 完了数  │ 消化数  │ 計画数  │
├────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ 2024-01-15 │ 15      │ 0       │ 2       │ 1       │ 0       │ 0       │ 18      │ 18      │ 25      │
│ 2024-01-16 │ 20      │ 0       │ 1       │ 0       │ 0       │ 0       │ 21      │ 21      │ 30      │
└────────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘

セット2:
┌────────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Date       │ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ 完了数  │ 消化数  │ 計画数  │
├────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ 2024-01-15 │ 10      │ 0       │ 1       │ 0       │ 0       │ 0       │ 11      │ 11      │ 15      │
│ 2024-01-16 │ 15      │ 0       │ 0       │ 0       │ 0       │ 0       │ 15      │ 15      │ 20      │
└────────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
```

#### 複数ファイル処理の場合
```
==========================================
TestSpecAnalytics Results
==========================================

Processed Files: 3
Total Processing Time: 2.3s

SUMMARY TOTAL RESULTS:
┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────────┬─────────────┐
│ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ Total   │ 完了数  │ 消化数  │ 完了率(%)   │ 消化率(%)   │
├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────────┼─────────────┤
│ 103     │ 3       │ 1       │ 1       │ 0       │ 21      │ 129     │ 100     │ 120     │ 22.99       │ 27.59       │
└─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────────┴─────────────┘

SUMMARY STATISTICS:
┌─────────────┬─────────┐
│ Metric      │ Total   │
├─────────────┼─────────┤
│ All Cases   │ 450     │
│ Available   │ 435     │
│ Executed    │ 360     │
│ Completed   │ 300     │
│ Incompleted │ 75      │
│ Planned     │ 240     │
└─────────────┴─────────┘

OVERALL STATUS: In Progress
Earliest Start Date: 2024-01-10
Latest Update: 2024-01-25

==========================================
File: sample1.xlsx
==========================================

Total Cases: 150
Available Cases: 145
Excluded Cases: 5

TOTAL RESULTS:
┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────────┬─────────────┐
│ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ Total   │ 完了数  │ 消化数  │ 完了率(%)   │ 消化率(%)   │
├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────────┼─────────────┤
│ 33      │ 1       │ 0       │ 0       │ 0       │ 9       │ 43      │ 100     │ 120     │ 68.97       │ 82.76       │
└─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────────┴─────────────┘

STATISTICS:
┌─────────────┬─────────┐
│ Metric      │ Count   │
├─────────────┼─────────┤
│ All         │ 150     │
│ Available   │ 145     │
│ Executed    │ 120     │
│ Completed   │ 100     │
│ Incompleted │ 25      │
│ Planned     │ 80      │
└─────────────┴─────────┘

STATUS: In Progress
Start Date: 2024-01-15
Last Update: 2024-01-20

DAILY BREAKDOWN:
┌────────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Date       │ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ 完了数  │ 消化数  │ 計画数  │
├────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ 2024-01-15 │ 10      │ 0       │ 2       │ 1       │ 0       │ 0       │ 13      │ 13      │ 20      │
│ 2024-01-16 │ 15      │ 0       │ 1       │ 0       │ 0       │ 0       │ 16      │ 16      │ 25      │
└────────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘

==========================================
File: sample2.xlsx
==========================================

Total Cases: 200
Available Cases: 190
Excluded Cases: 10

TOTAL RESULTS:
┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────────┬─────────────┐
│ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ Total   │ 完了数  │ 消化数  │ 完了率(%)   │ 消化率(%)   │
├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────────┼─────────────┤
│ 45      │ 2       │ 1       │ 0       │ 0       │ 12      │ 60      │ 120     │ 150     │ 63.16       │ 78.95       │
└─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────────┴─────────────┘

STATISTICS:
┌─────────────┬─────────┐
│ Metric      │ Count   │
├─────────────┼─────────┤
│ All         │ 200     │
│ Available   │ 190     │
│ Executed    │ 150     │
│ Completed   │ 120     │
│ Incompleted │ 40      │
│ Planned     │ 100     │
└─────────────┴─────────┘

STATUS: In Progress
Start Date: 2024-01-10
Last Update: 2024-01-25

DAILY BREAKDOWN:
┌────────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Date       │ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ 完了数  │ 消化数  │ 計画数  │
├────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ 2024-01-10 │ 20      │ 0       │ 5       │ 2       │ 0       │ 0       │ 27      │ 27      │ 35      │
│ 2024-01-15 │ 25      │ 0       │ 3       │ 1       │ 0       │ 0       │ 29      │ 29      │ 40      │
│ 2024-01-25 │ 30      │ 0       │ 2       │ 0       │ 0       │ 0       │ 32      │ 32      │ 45      │
└────────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘

BY ENVIRONMENT:

セット1:
┌────────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Date       │ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ 完了数  │ 消化数  │ 計画数  │
├────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ 2024-01-10 │ 15      │ 0       │ 3       │ 1       │ 0       │ 0       │ 19      │ 19      │ 25      │
│ 2024-01-15 │ 18      │ 0       │ 2       │ 0       │ 0       │ 0       │ 20      │ 20      │ 30      │
│ 2024-01-25 │ 22      │ 0       │ 1       │ 0       │ 0       │ 0       │ 23      │ 23      │ 35      │
└────────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘

セット2:
┌────────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Date       │ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ 完了数  │ 消化数  │ 計画数  │
├────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ 2024-01-10 │ 5       │ 0       │ 2       │ 1       │ 0       │ 0       │ 8       │ 8       │ 10      │
│ 2024-01-15 │ 7       │ 0       │ 1       │ 1       │ 0       │ 0       │ 9       │ 9       │ 10      │
│ 2024-01-25 │ 8       │ 0       │ 1       │ 0       │ 0       │ 0       │ 9       │ 9       │ 10      │
└────────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘

==========================================
File: sample3.xlsx
==========================================

Total Cases: 100
Available Cases: 100
Excluded Cases: 0

TOTAL RESULTS:
┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────────┬─────────────┐
│ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ Total   │ 完了数  │ 消化数  │ 完了率(%)   │ 消化率(%)   │
├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────────┼─────────────┤
│ 25      │ 0       │ 0       │ 0       │ 0       │ 5       │ 30      │ 80      │ 90      │ 80.00       │ 90.00       │
└─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────────┴─────────────┘

STATISTICS:
┌─────────────┬─────────┐
│ Metric      │ Count   │
├─────────────┼─────────┤
│ All         │ 100     │
│ Available   │ 100     │
│ Executed    │ 90      │
│ Completed   │ 80      │
│ Incompleted │ 10      │
│ Planned     │ 60      │
└─────────────┴─────────┘

STATUS: Completed
Start Date: 2024-01-12
Last Update: 2024-01-18

DAILY BREAKDOWN:
┌────────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Date       │ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ 完了数  │ 消化数  │ 計画数  │
├────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ 2024-01-12 │ 15      │ 0       │ 1       │ 0       │ 0       │ 0       │ 16      │ 16      │ 20      │
│ 2024-01-18 │ 20      │ 0       │ 2       │ 1       │ 0       │ 0       │ 23      │ 23      │ 30      │
└────────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘

BY ENVIRONMENT:

セット1:
┌────────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Date       │ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ 完了数  │ 消化数  │ 計画数  │
├────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ 2024-01-12 │ 10      │ 0       │ 1       │ 0       │ 0       │ 0       │ 11      │ 11      │ 15      │
│ 2024-01-18 │ 12      │ 0       │ 1       │ 1       │ 0       │ 0       │ 14      │ 14      │ 20      │
└────────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘

セット2:
┌────────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Date       │ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ 完了数  │ 消化数  │ 計画数  │
├────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ 2024-01-12 │ 5       │ 0       │ 0       │ 0       │ 0       │ 0       │ 5       │ 5       │ 5       │
│ 2024-01-18 │ 8       │ 0       │ 1       │ 0       │ 0       │ 0       │ 9       │ 9       │ 10      │
└────────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
```

### 5.2 JSON形式出力

#### 単一ファイル処理の場合
```json
{
  "file": "sample1.xlsx",
  "total": {
    "Pass": 33,
    "Fixed": 1,
    "Fail": 0,
    "Blocked": 0,
    "Suspend": 0,
    "N/A": 9,
    "Total": 43,
    "完了数": 100,
    "消化数": 120,
    "完了率(%)": 68.97,
    "消化率(%)": 82.76
  },
  "stats": {
    "all": 150,
    "excluded": 5,
    "available": 145,
    "executed": 120,
    "completed": 100,
    "incompleted": 25,
    "planned": 80
  },
  "run": {
    "status": "in_progress",
    "start_date": "2024-01-15",
    "last_update": "2024-01-20"
  },
  "daily": {
    "2024-01-15": {
      "Pass": 10,
      "Fixed": 0,
      "Fail": 2,
      "Blocked": 1,
      "Suspend": 0,
      "N/A": 0,
      "完了数": 13,
      "消化数": 13,
      "計画数": 20
    }
  },
  "by_name": {
    "2024-01-15": {
      "田中": 8,
      "佐藤": 3,
      "鈴木": 2
    },
    "2024-01-16": {
      "田中": 10,
      "佐藤": 4,
      "鈴木": 2
    }
  },
          "by_env": {
          "2024-01-15": {
            "セット1": {
              "Pass": 15,
              "Fixed": 0,
              "Fail": 2,
              "Blocked": 1,
              "Suspend": 0,
              "N/A": 0,
              "完了数": 18,
              "消化数": 18,
              "計画数": 25
            },
            "セット2": {
              "Pass": 10,
              "Fixed": 0,
              "Fail": 1,
              "Blocked": 0,
              "Suspend": 0,
              "N/A": 0,
              "完了数": 11,
              "消化数": 11,
              "計画数": 15
            }
          },
          "2024-01-16": {
            "セット1": {
              "Pass": 20,
              "Fail": 1,
              "Blocked": 0,
              "完了数": 21,
              "消化数": 21,
              "計画数": 30
            },
            "セット2": {
              "Pass": 15,
              "Fail": 0,
              "Blocked": 0,
              "完了数": 15,
              "消化数": 15,
              "計画数": 20
            }
          }
        }
}
```

#### 複数ファイル処理の場合
```json
{
  "summary": {
    "processed_files": 3,
    "processing_time": 2.3,
    "total_results": {
      "Pass": 103,
      "Fixed": 3,
      "Fail": 1,
      "Blocked": 1,
      "Suspend": 0,
      "N/A": 21,
      "Total": 129,
      "完了数": 100,
      "消化数": 120,
      "完了率(%)": 22.99,
      "消化率(%)": 27.59
    },
    "total_stats": {
      "all": 450,
      "excluded": 15,
      "available": 435,
      "executed": 360,
      "completed": 300,
      "incompleted": 75,
      "planned": 240
    },
    "overall_status": "in_progress",
    "earliest_start_date": "2024-01-10",
    "latest_update": "2024-01-25"
  },
  "files": [
    {
      "file": "sample1.xlsx",
      "total": {
        "Pass": 33,
        "Fixed": 1,
        "Fail": 0,
        "Blocked": 0,
        "Suspend": 0,
        "N/A": 9,
        "Total": 43,
        "完了数": 100,
        "消化数": 120,
        "完了率(%)": 68.97,
        "消化率(%)": 82.76
      },
      "stats": {
        "all": 150,
        "excluded": 5,
        "available": 145,
        "executed": 120,
        "completed": 100,
        "incompleted": 25,
        "planned": 80
      },
      "run": {
        "status": "in_progress",
        "start_date": "2024-01-15",
        "last_update": "2024-01-20"
      },
              "daily": {
          "2024-01-15": {
            "Pass": 10,
            "Fixed": 0,
            "Fail": 2,
            "Blocked": 1,
            "Suspend": 0,
            "N/A": 0,
            "完了数": 13,
            "消化数": 13,
            "計画数": 20
          }
        },
      "by_name": {
        "2024-01-15": {
          "田中": 8,
          "佐藤": 3,
          "鈴木": 2
        }
      },
                    "by_env": {
          "2024-01-15": {
            "セット1": {
              "Pass": 15,
              "Fixed": 0,
              "Fail": 2,
              "Blocked": 1,
              "Suspend": 0,
              "N/A": 0,
              "完了数": 18,
              "消化数": 18,
              "計画数": 25
            },
            "セット2": {
              "Pass": 10,
              "Fixed": 0,
              "Fail": 1,
              "Blocked": 0,
              "Suspend": 0,
              "N/A": 0,
              "完了数": 11,
              "消化数": 11,
              "計画数": 15
            }
          },
          "2024-01-16": {
            "セット1": {
              "Pass": 20,
              "Fixed": 0,
              "Fail": 1,
              "Blocked": 0,
              "Suspend": 0,
              "N/A": 0,
              "完了数": 21,
              "消化数": 21,
              "計画数": 30
            },
            "セット2": {
              "Pass": 15,
              "Fixed": 0,
              "Fail": 0,
              "Blocked": 0,
              "Suspend": 0,
              "N/A": 0,
              "完了数": 15,
              "消化数": 15,
              "計画数": 20
            }
          }
        }
    },
    {
      "file": "sample2.xlsx",
      "total": {
        "Pass": 45,
        "Fixed": 2,
        "Fail": 1,
        "Blocked": 0,
        "Suspend": 0,
        "N/A": 12,
        "Total": 60,
        "完了数": 120,
        "消化数": 150,
        "完了率(%)": 63.16,
        "消化率(%)": 78.95
      },
      "stats": {
        "all": 200,
        "excluded": 10,
        "available": 190,
        "executed": 150,
        "completed": 120,
        "incompleted": 40,
        "planned": 100
      },
      "run": {
        "status": "in_progress",
        "start_date": "2024-01-10",
        "last_update": "2024-01-25"
      },
              "daily": {
          "2024-01-10": {
            "Pass": 20,
            "Fail": 5,
            "Blocked": 2,
            "完了数": 27,
            "消化数": 27,
            "計画数": 35
          }
        },
      "by_name": {
        "2024-01-10": {
          "田中": 15,
          "佐藤": 8,
          "鈴木": 4
        }
      },
              "by_env": {
          "2024-01-10": {
            "セット1": {
              "Pass": 15,
              "Fail": 3,
              "Blocked": 1,
              "完了数": 19,
              "消化数": 19,
              "計画数": 25
            },
            "セット2": {
              "Pass": 5,
              "Fail": 2,
              "Blocked": 1,
              "完了数": 8,
              "消化数": 8,
              "計画数": 10
            }
          },
          "2024-01-15": {
            "セット1": {
              "Pass": 18,
              "Fail": 2,
              "Blocked": 0,
              "完了数": 20,
              "消化数": 20,
              "計画数": 30
            },
            "セット2": {
              "Pass": 7,
              "Fail": 1,
              "Blocked": 1,
              "完了数": 9,
              "消化数": 9,
              "計画数": 10
            }
          },
          "2024-01-25": {
            "セット1": {
              "Pass": 22,
              "Fail": 1,
              "Blocked": 0,
              "完了数": 23,
              "消化数": 23,
              "計画数": 35
            },
            "セット2": {
              "Pass": 8,
              "Fail": 1,
              "Blocked": 0,
              "完了数": 9,
              "消化数": 9,
              "計画数": 10
            }
          }
        }
    },
    {
      "file": "sample3.xlsx",
      "total": {
        "Pass": 25,
        "Fixed": 0,
        "Fail": 0,
        "Blocked": 0,
        "Suspend": 0,
        "N/A": 5,
        "Total": 30,
        "完了数": 80,
        "消化数": 90,
        "完了率(%)": 80.00,
        "消化率(%)": 90.00
      },
      "stats": {
        "all": 100,
        "excluded": 0,
        "available": 100,
        "executed": 90,
        "completed": 80,
        "incompleted": 10,
        "planned": 60
      },
      "run": {
        "status": "completed",
        "start_date": "2024-01-12",
        "last_update": "2024-01-18"
      },
              "daily": {
          "2024-01-12": {
            "Pass": 15,
            "Fail": 1,
            "Blocked": 0,
            "完了数": 16,
            "消化数": 16,
            "計画数": 20
          }
        },
      "by_name": {
        "2024-01-12": {
          "田中": 10,
          "佐藤": 4,
          "鈴木": 2
        }
      },
              "by_env": {
          "2024-01-12": {
            "セット1": {
              "Pass": 10,
              "Fail": 1,
              "Blocked": 0,
              "完了数": 11,
              "消化数": 11,
              "計画数": 15
            },
            "セット2": {
              "Pass": 5,
              "Fail": 0,
              "Blocked": 0,
              "完了数": 5,
              "消化数": 5,
              "計画数": 5
            }
          },
          "2024-01-18": {
            "セット1": {
              "Pass": 12,
              "Fail": 1,
              "Blocked": 1,
              "完了数": 14,
              "消化数": 14,
              "計画数": 20
            },
            "セット2": {
              "Pass": 8,
              "Fail": 1,
              "Blocked": 0,
              "完了数": 9,
              "消化数": 9,
              "計画数": 10
            }
          }
        }
    }
  ]
}
```

### 5.3 詳細ログ（-v/--verbose オプション）

-v/--verbose オプションを指定すると、以下の詳細ログがコンソールに出力される。
- ファイル処理の詳細（検索開始、対象パス、ファイル数、ファイルサイズ、最終更新日時、処理時間など）
- Excelワークブック・シート情報（シート数、使用シート名、ヘッダー行位置、データ範囲など）
- 列マッピング情報（結果列・担当者列・日付列・計画列の位置）
- データ検証情報（有効/無効な日付データ数、担当者名リスト、環境名リスト）
- 結果タイプ別集計の詳細（件数・割合）
- 日別・担当者別・環境別の集計詳細
- エラー・警告発生時の詳細内容
- 各処理の所要時間

#### ログ例
```
[VERBOSE] 02:03:58.557 - ファイル検索開始: input_sample/sample1.xlsx
[VERBOSE] 02:03:58.557 - 検索対象パス: input_sample/sample1.xlsx
[VERBOSE] 02:03:58.557 - 処理対象ファイル数: 1
[VERBOSE] 02:03:58.557 - ファイル処理開始: input_sample/sample1.xlsx
[VERBOSE] 02:03:58.557 - ファイルサイズ: 12.0 KB
[VERBOSE] 02:03:58.557 - 最終更新日時: 2025-03-31 00:34:05
[VERBOSE] 02:03:58.565 - ワークブック情報:
[VERBOSE] 02:03:58.565 - - シート数: 3
[VERBOSE] 02:03:58.565 - - 使用シート: テスト項目1
[VERBOSE] 02:03:58.566 - シート処理開始: テスト項目1
[VERBOSE] 02:03:58.566 - データ読み取り範囲:
[VERBOSE] 02:03:58.566 - - ヘッダー行: 10行目
[VERBOSE] 02:03:58.566 - - データ開始行: 11行目
[VERBOSE] 02:03:58.566 - - データ終了行: 22行目
[VERBOSE] 02:03:58.566 - - 総データ行数: 12行
[VERBOSE] 02:03:58.566 - 列マッピング:
[VERBOSE] 02:03:58.566 - - 結果列: P列, T列
[VERBOSE] 02:03:58.566 - - 担当者列: Q列, U列
[VERBOSE] 02:03:58.566 - - 日付列: R列, V列
[VERBOSE] 02:03:58.567 - データ検証結果:
[VERBOSE] 02:03:58.567 - - 有効な日付データ: 19件
[VERBOSE] 02:03:58.567 - - 無効な日付データ: 5件
[VERBOSE] 02:03:58.567 - - 担当者データ: 2名 (Aさん, Bさん)
[VERBOSE] 02:03:58.567 - - 環境データ: 2環境 (環境a_abc, 環境b_cde)
[VERBOSE] 02:03:58.567 - シート処理完了: テスト項目1 - データ行数: 24
[VERBOSE] 02:03:58.567 - 結果タイプ別集計:
[VERBOSE] 02:03:58.567 - - Pass: 15件 (62.5%)
[VERBOSE] 02:03:58.567 - - Fixed: 1件 (4.2%)
[VERBOSE] 02:03:58.567 - - Fail: 1件 (4.2%)
[VERBOSE] 02:03:58.567 - - Blocked: 1件 (4.2%)
[VERBOSE] 02:03:58.567 - 日別データ処理:
[VERBOSE] 02:03:58.568 - - 2025-02-11: 20件 (Pass:6, Fail:1)
[VERBOSE] 02:03:58.568 - - 2025-02-12: 14件 (Pass:3, Fixed:1, Blocked:1)
[VERBOSE] 02:03:58.568 - - 2025-02-13: 15件 (Pass:5)
[VERBOSE] 02:03:58.568 - - 2025-02-15: 3件 (Pass:1)
[VERBOSE] 02:03:58.568 - 担当者別集計:
[VERBOSE] 02:03:58.568 - - 2025-02-11: {'Aさん': 3, 'Bさん': 4}件
[VERBOSE] 02:03:58.568 - - 2025-02-12: {'Aさん': 5}件
[VERBOSE] 02:03:58.568 - - 2025-02-13: {'Bさん': 5}件
[VERBOSE] 02:03:58.568 - - 2025-02-15: {'Aさん': 1}件
[VERBOSE] 02:03:58.568 - 環境別集計:
[VERBOSE] 02:03:58.568 - - 環境a_abc: 31件
[VERBOSE] 02:03:58.568 - - 環境b_cde: 21件
[VERBOSE] 02:03:58.568 - ファイル処理時間: 0.01秒
[VERBOSE] 02:03:58.568 - データ読み取り・集計時間: 0.01秒
[VERBOSE] 02:03:58.572 - 総処理時間: 0.02秒
```

## 6. エラーハンドリング

### 6.1 エラーケース
- ファイルが見つからない
- 設定ファイルが無効
- Excelファイルの形式エラー
- データ読み取りエラー
- 権限エラー

### 6.2 エラー出力形式
```
ERROR: File not found - sample1.xlsx
ERROR: Invalid configuration file - config.json
ERROR: Excel file format error - corrupted.xlsx
```

## 7. 実装済み機能

### 7.1 複数ファイル統合集計機能
- **SUMMARY TOTAL RESULTS**: 複数ファイルのTOTAL RESULTSを統合して表示
- **完了数・消化数集計**: 各ファイルのdailyデータから完了数と消化数を統合集計
- **完了率・消化率計算**: 完了数/消化数をAvailable Caseで割ってパーセンテージを計算
- **表示順序**: SUMMARY TOTAL RESULTS → SUMMARY STATISTICS → OVERALL STATUS

### 7.2 集計ロジック
- 各ファイルの`total_results`を統合（Pass、Fixed、Fail、Blocked、Suspend、N/A）
- 各ファイルの`daily`データから完了数と消化数を集計
- 設定ファイルの`completed_results`と`executed_results`に基づいて正しい結果タイプを判定
- **完了率計算**: `完了数 / Available Case * 100`（小数点以下2桁で丸め）
- **消化率計算**: `消化数 / Available Case * 100`（小数点以下2桁で丸め）

## 8. フィルタリング機能

### 8.1 概要
テスト結果データを特定の条件でフィルタリングし、条件に合致するデータのみを集計・表示する機能です。複数のフィルタ条件を組み合わせて使用できます。

### 8.2 フィルタリングオプション

#### 8.2.1 日付範囲フィルタ（--date-range）
- **オプション**: `--date-range START_DATE [END_DATE]`
- **形式**: YYYY-MM-DD（例：2024-01-15）
- **説明**: 指定された日付範囲内のテスト結果のみを集計
- **使用例**:
  ```bash
  # 2024年1月15日から1月20日までのデータ（範囲指定）
  python test_spec_analytics.py --date-range 2024-01-15 2024-01-20 sample1.xlsx
  
  # 2024年1月1日から1月31日までのデータ（範囲指定）
  python test_spec_analytics.py --date-range 2024-01-01 2024-01-31 input_sample/
  
  # 2024年1月15日以降すべてのデータ（開始日のみ指定）
  python test_spec_analytics.py --date-range 2024-01-15 sample1.xlsx
  
  # 2024年1月20日以前すべてのデータ（終了日のみ指定）
  python test_spec_analytics.py --date-range "" 2024-01-20 sample1.xlsx
  ```

#### 8.2.2 担当者フィルタ（--assignee）
- **オプション**: `--assignee ASSIGNEE_NAME [--exact-match]`
- **形式**: 担当者名（デフォルト：部分一致、--exact-match指定時：完全一致）
- **説明**: 指定された担当者が実行したテスト結果のみを集計
- **使用例**:
  ```bash
  # 田中さんが担当したテストのみ（部分一致）
  python test_spec_analytics.py --assignee 田中 sample1.xlsx
  
  # 佐藤さんが担当したテストのみ（部分一致、複数ファイル）
  python test_spec_analytics.py --assignee 佐藤 input_sample/
  
  # 田中さんが担当したテストのみ（完全一致）
  python test_spec_analytics.py --assignee 田中 --exact-match sample1.xlsx
  
  # "田"を含む名前の担当者のテスト
  python test_spec_analytics.py --assignee 田 input_sample/
  ```

#### 8.2.3 結果タイプフィルタ（--result-type）
- **オプション**: `--result-type RESULT_TYPE [RESULT_TYPE2 ...]`
- **形式**: Pass, Fixed, Fail, Blocked, Suspend, N/A（設定ファイルのtest_statusに定義された値）
- **説明**: 指定された結果タイプのテスト結果のみを集計（複数指定可能）
- **使用例**:
  ```bash
  # Passのみのテスト結果
  python test_spec_analytics.py --result-type Pass sample1.xlsx
  
  # Failのみのテスト結果（複数ファイル）
  python test_spec_analytics.py --result-type Fail input_sample/
  
  # PassとFailのテスト結果
  python test_spec_analytics.py --result-type Pass Fail sample1.xlsx
  
  # 完了したテスト結果（Pass, Fixed）
  python test_spec_analytics.py --result-type Pass Fixed input_sample/
  
  # 問題のあるテスト結果（Fail, Blocked）
  python test_spec_analytics.py --result-type Fail Blocked sample1.xlsx
  ```

#### 8.2.4 環境フィルタ（--environment）
- **オプション**: `--environment ENV_NAME [--exact-match]`
- **形式**: 環境名（デフォルト：部分一致、--exact-match指定時：完全一致）
- **説明**: 指定された環境で実行されたテスト結果のみを集計
- **使用例**:
  ```bash
  # セット1環境のテストのみ（部分一致）
  python test_spec_analytics.py --environment セット1 sample1.xlsx
  
  # 環境a_abcのテストのみ（部分一致、複数ファイル）
  python test_spec_analytics.py --environment 環境a_abc input_sample/
  
  # セット1環境のテストのみ（完全一致）
  python test_spec_analytics.py --environment セット1 --exact-match sample1.xlsx
  
  # "セット"を含むすべての環境のテスト
  python test_spec_analytics.py --environment セット input_sample/
  ```

### 8.3 複合フィルタリング

複数のフィルタ条件を組み合わせて使用できます。すべての条件を満たすデータのみが集計されます。

#### 8.3.1 使用例
```bash
# 田中さんが2024年1月15日から20日までにPassしたテスト
python test_spec_analytics.py --date-range 2024-01-15 2024-01-20 --assignee 田中 --result-type Pass sample1.xlsx

# セット1環境で佐藤さんがFailしたテスト（複数ファイル）
python test_spec_analytics.py --environment セット1 --assignee 佐藤 --result-type Fail input_sample/

# 2024年1月1日から31日までにBlockedされたテスト（詳細ログ付き）
python test_spec_analytics.py --date-range 2024-01-01 2024-01-31 --result-type Blocked -v input_sample/

# 完了したテスト結果（Pass, Fixed）を日付範囲で絞り込み
python test_spec_analytics.py --date-range 2024-01-15 2024-01-20 --result-type Pass Fixed sample1.xlsx

# 問題のあるテスト結果（Fail, Blocked）を担当者で絞り込み
python test_spec_analytics.py --assignee 田中 --result-type Fail Blocked input_sample/

# 2024年1月15日以降のすべてのテスト結果
python test_spec_analytics.py --date-range 2024-01-15 input_sample/

# 2024年1月20日以前の田中さんのテスト結果
python test_spec_analytics.py --date-range "" 2024-01-20 --assignee 田中 sample1.xlsx

# "セット"を含む環境で"田"を含む名前の担当者が実行したテスト
python test_spec_analytics.py --environment セット --assignee 田 input_sample/

# 完全一致でセット1環境のテスト
python test_spec_analytics.py --environment セット1 --exact-match sample1.xlsx
```

### 8.4 フィルタリング結果の表示

#### 8.4.1 テーブル形式出力
フィルタリング条件が適用された場合、出力の冒頭にフィルタ条件が表示されます：

```
==========================================
TestSpecAnalytics Results
==========================================

Filter Conditions:
- Date Range: 2024-01-15 to 2024-01-20
- Assignee: 田中 (partial match)
- Result Type: Pass, Fixed
- Environment: セット1 (partial match)

File: sample1.xlsx
Filtered Cases: 15 (from 150 total cases)
Available Cases: 145
Excluded Cases: 5

TOTAL RESULTS (Filtered):
┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────────┬─────────────┐
│ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ Total   │ 完了数  │ 消化数  │ 完了率(%)   │ 消化率(%)   │
├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────────┼─────────────┤
│ 15      │ 0       │ 0       │ 0       │ 0       │ 0       │ 15      │ 15      │ 15      │ 100.00      │ 100.00      │
└─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────────┴─────────────┘
```

**日付範囲の表示例**:
- 範囲指定: `Date Range: 2024-01-15 to 2024-01-20`
- 開始日のみ: `Date Range: 2024-01-15 onwards`
- 終了日のみ: `Date Range: up to 2024-01-20`

File: sample1.xlsx
Filtered Cases: 15 (from 150 total cases)
Available Cases: 145
Excluded Cases: 5

TOTAL RESULTS (Filtered):
┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────────┬─────────────┐
│ Pass    │ Fixed   │ Fail    │ Blocked │ Suspend │ N/A     │ Total   │ 完了数  │ 消化数  │ 完了率(%)   │ 消化率(%)   │
├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────────┼─────────────┤
│ 15      │ 0       │ 0       │ 0       │ 0       │ 0       │ 15      │ 15      │ 15      │ 100.00      │ 100.00      │
└─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────────┴─────────────┘
```

#### 8.4.2 JSON形式出力
フィルタリング条件が適用された場合、JSON出力にフィルタ情報が含まれます：

**日付範囲のJSON表現**:
- 範囲指定: `"start": "2024-01-15", "end": "2024-01-20"`
- 開始日のみ: `"start": "2024-01-15", "end": null`
- 終了日のみ: `"start": null, "end": "2024-01-20"`

**フィルタ一致方式のJSON表現**:
- 部分一致: `"match_type": "partial"`
- 完全一致: `"match_type": "exact"`

**結果タイプのJSON表現**:
- 単一指定: `"result_type": "Pass"`
- 複数指定: `"result_type": ["Pass", "Fixed"]`

```json
{
  "filters": {
    "date_range": {
      "start": "2024-01-15",
      "end": "2024-01-20"
    },
    "assignee": {
      "value": "田中",
      "match_type": "partial"
    },
    "result_type": ["Pass", "Fixed"],
    "environment": {
      "value": "セット1",
      "match_type": "partial"
    }
  },
  "file": "sample1.xlsx",
  "filtered_cases": 15,
  "total_cases": 150,
  "total": {
    "Pass": 15,
    "Fixed": 0,
    "Fail": 0,
    "Blocked": 0,
    "Suspend": 0,
    "N/A": 0,
    "Total": 15,
    "完了数": 15,
    "消化数": 15,
    "完了率(%)": 100.00,
    "消化率(%)": 100.00
  }
}
```

### 8.5 フィルタリングの詳細ログ（-v/--verbose）

詳細ログオプションと組み合わせた場合、フィルタリング処理の詳細が表示されます：

```
[VERBOSE] 02:03:58.557 - フィルタ条件適用開始
[VERBOSE] 02:03:58.557 - - 日付範囲: 2024-01-15 から 2024-01-20
[VERBOSE] 02:03:58.557 - - 担当者: 田中 (部分一致)
[VERBOSE] 02:03:58.557 - - 結果タイプ: Pass, Fixed
[VERBOSE] 02:03:58.557 - - 環境: セット1 (部分一致)
[VERBOSE] 02:03:58.568 - フィルタ適用前データ: 150件
[VERBOSE] 02:03:58.568 - 日付フィルタ適用後: 45件
[VERBOSE] 02:03:58.568 - 担当者フィルタ適用後: 18件
[VERBOSE] 02:03:58.568 - 結果タイプフィルタ適用後: 15件
[VERBOSE] 02:03:58.568 - 環境フィルタ適用後: 15件
[VERBOSE] 02:03:58.568 - フィルタ適用後データ: 15件 (90.0%削減)
```

**日付範囲の詳細ログ例**:
```
[VERBOSE] 02:03:58.557 - - 日付範囲: 2024-01-15 onwards (開始日のみ)
[VERBOSE] 02:03:58.557 - - 日付範囲: up to 2024-01-20 (終了日のみ)
[VERBOSE] 02:03:58.557 - - 日付範囲: 2024-01-15 から 2024-01-20 (範囲指定)
```

**一致方式の詳細ログ例**:
```
[VERBOSE] 02:03:58.557 - - 担当者: 田中 (完全一致)
[VERBOSE] 02:03:58.557 - - 担当者: 田中 (部分一致)
[VERBOSE] 02:03:58.557 - - 環境: セット1 (完全一致)
[VERBOSE] 02:03:58.557 - - 環境: セット1 (部分一致)
```

**結果タイプの詳細ログ例**:
```
[VERBOSE] 02:03:58.557 - - 結果タイプ: Pass (単一)
[VERBOSE] 02:03:58.557 - - 結果タイプ: Pass, Fixed (複数)
[VERBOSE] 02:03:58.557 - - 結果タイプ: Fail, Blocked, Suspend (複数)
```

### 8.6 エラーハンドリング

#### 8.6.1 フィルタ条件エラー
- 無効な日付形式
- 存在しない担当者名（部分一致でも該当なしの場合）
- 無効な結果タイプ（複数指定時は1つでも無効な値があるとエラー）
- 存在しない環境名（部分一致でも該当なしの場合）
- 日付範囲の開始日が終了日より後の場合

#### 8.6.2 エラー出力例
```
ERROR: Invalid date format - 2024/01/15 (use YYYY-MM-DD)
ERROR: Assignee not found - 山田 (available: 田中, 佐藤, 鈴木)
ERROR: Invalid result type - Invalid (available: Pass, Fixed, Fail, Blocked, Suspend, N/A)
ERROR: Environment not found - セット3 (available: セット1, セット2)
ERROR: Invalid date range - start date (2024-01-20) is after end date (2024-01-15)
ERROR: No matching assignees found - 山田 (partial match, available: 田中, 佐藤, 鈴木)
ERROR: No matching environments found - セット3 (partial match, available: セット1, セット2)
ERROR: Invalid result types - Pass, Invalid, Fail (available: Pass, Fixed, Fail, Blocked, Suspend, N/A)
```

### 8.7 実装上の注意事項

#### 8.7.1 フィルタリング順序
1. 日付範囲フィルタ
2. 担当者フィルタ
3. 結果タイプフィルタ
4. 環境フィルタ

#### 8.7.2 日付範囲フィルタの仕様
- **範囲指定**: `--date-range START_DATE END_DATE`
- **開始日のみ**: `--date-range START_DATE`（終了日は指定しない）
- **終了日のみ**: `--date-range "" END_DATE`（開始日は空文字で指定）
- **日付形式**: YYYY-MM-DD（例：2024-01-15）
- **日付比較**: 指定された日付を含む（以上・以下）
- **バリデーション**: 開始日が終了日より後の場合はエラー

#### 8.7.3 文字列フィルタの仕様
- **担当者・環境フィルタ**: デフォルトで部分一致、`--exact-match`指定時は完全一致
- **部分一致**: 指定された文字列を含むすべての値にマッチ
- **完全一致**: 指定された文字列と完全に一致する値のみマッチ
- **大文字小文字**: 区別しない（例：「田中」と「たなか」は同じ扱い）
- **空白文字**: 前後の空白を除去して比較
- **バリデーション**: 部分一致でも該当する値が見つからない場合はエラー

#### 8.7.4 結果タイプフィルタの仕様
- **複数指定**: スペース区切りで複数の結果タイプを指定可能
- **OR条件**: 指定された結果タイプのいずれかに該当するデータを抽出
- **バリデーション**: 1つでも無効な結果タイプがあるとエラー
- **重複除去**: 同じ結果タイプを複数回指定しても重複は除去
- **順序**: 指定順序は保持されるが、出力時の順序は結果タイプの定義順

#### 8.7.5 パフォーマンス考慮
- 大量データでのフィルタリング処理時間
- メモリ使用量の最適化
- 複数ファイル処理時の効率化

#### 8.7.6 データ整合性
- フィルタ適用後の統計値の再計算
- 完了率・消化率の正確な算出
- 日別・担当者別・環境別集計の更新

## 9. 将来拡張予定

### 9.1 出力オプション
- 特定の統計情報のみ出力

## 11. CSV/Excel形式出力機能

### 11.1 概要
集計結果をCSV形式またはExcel形式でファイルに出力する機能です。コンソール出力と併用して、データの保存・共有・分析に活用できます。

### 11.2 コマンドラインオプション

#### 11.2.1 基本オプション
| オプション | 短縮形 | 説明 | デフォルト値 |
|------------|--------|------|--------------|
| `--output-file` | `-o` | 出力ファイルパス | なし（コンソール出力のみ） |
| `--output-format` | `-f` | 出力形式（table/json/csv/excel） | `table` |

#### 11.2.2 使用例
```bash
# CSV形式でファイル出力
python test_spec_analytics.py -o results.csv sample1.xlsx

# Excel形式でファイル出力
python test_spec_analytics.py -o results.xlsx sample1.xlsx

# JSON形式でファイル出力
python test_spec_analytics.py -o results.json -f json sample1.xlsx

# 複数ファイル処理でCSV出力
python test_spec_analytics.py -o summary.csv input_sample/

# フィルタリング結果をExcel出力
python test_spec_analytics.py -o filtered_results.xlsx --date-range 2024-01-15 2024-01-20 sample1.xlsx
```

### 11.3 CSV形式出力仕様

#### 11.3.1 単一ファイル処理の場合
出力ファイル：`results.csv`

**TOTAL RESULTS シート**:
```csv
Category,Pass,Fixed,Fail,Blocked,Suspend,N/A,Total,完了数,消化数,完了率(%),消化率(%)
TOTAL RESULTS,33,1,0,0,0,9,43,100,120,68.97,82.76
```

**STATISTICS シート**:
```csv
Metric,Count
All,150
Available,145
Executed,120
Completed,100
Incompleted,25
Planned,80
```

**DAILY BREAKDOWN シート**:
```csv
Date,Pass,Fixed,Fail,Blocked,Suspend,N/A,完了数,消化数,計画数
2024-01-15,10,0,2,1,0,0,13,13,20
2024-01-16,15,0,1,0,0,0,16,16,25
```

**BY NAME シート**:
```csv
Date,田中,佐藤,鈴木,完了数,消化数,計画数
2024-01-15,8,3,2,13,13,20
2024-01-16,10,4,2,16,16,25
```

**BY ENVIRONMENT シート**:
```csv
Date,Environment,Pass,Fixed,Fail,Blocked,Suspend,N/A,完了数,消化数,計画数
2024-01-15,セット1,15,0,2,1,0,0,18,18,25
2024-01-15,セット2,10,0,1,0,0,0,11,11,15
2024-01-16,セット1,20,0,1,0,0,0,21,21,30
2024-01-16,セット2,15,0,0,0,0,0,15,15,20
```

#### 11.3.2 複数ファイル処理の場合
出力ファイル：`summary.csv`

**SUMMARY TOTAL RESULTS シート**:
```csv
Category,Pass,Fixed,Fail,Blocked,Suspend,N/A,Total,完了数,消化数,完了率(%),消化率(%)
SUMMARY TOTAL RESULTS,103,3,1,1,0,21,129,100,120,22.99,27.59
```

**SUMMARY STATISTICS シート**:
```csv
Metric,Total
All Cases,450
Available,435
Executed,360
Completed,300
Incompleted,75
Planned,240
```

**INDIVIDUAL FILES シート**:
```csv
File,Total Cases,Available Cases,Excluded Cases,Pass,Fixed,Fail,Blocked,Suspend,N/A,Total,完了数,消化数,完了率(%),消化率(%)
sample1.xlsx,150,145,5,33,1,0,0,0,9,43,100,120,68.97,82.76
sample2.xlsx,200,190,10,45,2,1,0,0,12,60,120,150,63.16,78.95
sample3.xlsx,100,100,0,25,0,0,0,0,5,30,80,90,80.00,90.00
```

### 11.4 Excel形式出力仕様

#### 11.4.1 ファイル構造
- **ワークブック**: 1つのExcelファイル（.xlsx）
- **シート構成**: 複数のシートでデータを分類
- **書式設定**: ヘッダー行の背景色、罫線、数値フォーマット

#### 11.4.2 シート構成

**単一ファイル処理の場合**:
1. **TOTAL RESULTS** - 集計結果のサマリー
2. **STATISTICS** - 統計情報
3. **DAILY BREAKDOWN** - 日別集計
4. **BY NAME** - 担当者別集計
5. **BY ENVIRONMENT** - 環境別集計
6. **METADATA** - ファイル情報・処理条件

**複数ファイル処理の場合**:
1. **SUMMARY TOTAL RESULTS** - 統合集計結果
2. **SUMMARY STATISTICS** - 統合統計情報
3. **INDIVIDUAL FILES** - 各ファイルのサマリー
4. **DAILY BREAKDOWN** - 統合日別集計
5. **BY NAME** - 統合担当者別集計
6. **BY ENVIRONMENT** - 統合環境別集計
7. **METADATA** - 処理情報・フィルタ条件

#### 11.4.3 書式設定
- **ヘッダー行**: 背景色（グレー）、太字、中央揃え
- **データ行**: 左揃え（文字列）、右揃え（数値）
- **罫線**: 全セルに細い罫線
- **数値フォーマット**: パーセンテージは小数点以下2桁
- **列幅**: 内容に応じた自動調整

#### 11.4.4 METADATA シート内容
```csv
項目,値
処理日時,2024-01-25 14:30:00
処理ファイル数,3
総処理時間,2.3秒
フィルタ条件,日付範囲: 2024-01-15 から 2024-01-20
出力形式,Excel
設定ファイル,config.json
```

### 11.5 フィルタリング対応

#### 11.5.1 フィルタ情報の出力
- **METADATA シート**: 適用されたフィルタ条件を記録
- **ファイル名**: フィルタ条件を含むファイル名を自動生成
- **シート名**: フィルタ条件に応じたシート名

#### 11.5.2 ファイル名自動生成例
```bash
# 基本出力
python test_spec_analytics.py -o results.xlsx sample1.xlsx
# → results.xlsx

# 日付フィルタ
python test_spec_analytics.py -o results.xlsx --date-range 2024-01-15 2024-01-20 sample1.xlsx
# → results_2024-01-15_to_2024-01-20.xlsx

# 複合フィルタ
python test_spec_analytics.py -o results.xlsx --date-range 2024-01-15 2024-01-20 --assignee 田中 sample1.xlsx
# → results_2024-01-15_to_2024-01-20_田中.xlsx
```

### 11.6 エラーハンドリング

#### 11.6.1 ファイル出力エラー
- 出力先ディレクトリが存在しない
- ファイルが既に存在し、上書き権限がない
- ディスク容量不足
- 無効なファイル形式

#### 11.6.2 エラー出力例
```
ERROR: Output directory not found - /invalid/path/
ERROR: File already exists and cannot be overwritten - results.xlsx
ERROR: Insufficient disk space - 50MB required, 10MB available
ERROR: Invalid file extension - results.txt (use .csv or .xlsx)
```

### 11.7 実装上の注意事項

#### 11.7.1 依存関係
- **CSV出力**: Python標準ライブラリ（csv）
- **Excel出力**: openpyxl（既存依存関係）
- **ファイル操作**: os, pathlib（標準ライブラリ）

#### 11.7.2 パフォーマンス考慮
- 大量データでのExcel出力時間
- メモリ使用量の最適化
- 複数ファイル処理時の効率化

#### 11.7.3 データ整合性
- コンソール出力とファイル出力の内容一致
- 文字エンコーディング（UTF-8）
- 数値フォーマットの統一

#### 11.7.4 ファイル命名規則
- **基本形式**: `{指定名}.{拡張子}`
- **フィルタ適用時**: `{指定名}_{フィルタ条件}.{拡張子}`
- **重複回避**: 同名ファイルが存在する場合は自動的に番号を付与

#### 11.7.5 出力オプションの組み合わせ
- **コンソール + ファイル**: 両方に出力
- **ファイルのみ**: `--output-file`指定時はコンソール出力を抑制
- **形式指定**: `--output-format`で出力形式を明示的に指定

### 9.2 バッチ処理
- 複数フォルダの一括処理
- 処理結果のサマリーレポート

### 9.3 追加フィルタリング機能
- 複数担当者指定（--assignees）
- 複数結果タイプ指定（--result-types）
- 複数環境指定（--environments）
- 正規表現による部分一致フィルタ
- 数値範囲フィルタ（テストケース数など）

## 10. 技術要件

### 10.1 依存関係
- Python 3.7以上
- openpyxl（Excelファイル読み取り）
- argparse（コマンドライン引数処理）
- json（設定ファイル処理）

### 10.2 ファイル構成
```
TestSpecAnalyticsCLI/
├── test_spec_analytics.py    # メインCLIツール
├── config.json        # デフォルト設定ファイル
└── utils/                   # 既存モジュール
    ├── ReadData.py          # データ読み取り・集計（複数ファイル統合機能含む）
    ├── OpenpyxlWrapper.py
    ├── TempDir.py
    ├── Utility.py
    └── Logger.py
```

### 10.3 主要機能実装
- **詳細ログ出力（-v/--verbose）**: `utils/Logger.py`の`VerboseLogger`クラスで実装。ファイル処理・Excel読み取り・データ検証・集計・エラー/警告など各段階で詳細なログを出力。`utils/ReadData.py`の集計関数や`test_spec_analytics.py`のメイン処理に統合し、-v指定時のみ詳細ログが有効になる。
- **フィルタリング機能**: `utils/ReadData.py`にフィルタリングロジックを追加。日付範囲・担当者・結果タイプ・環境によるフィルタリングを実装。`test_spec_analytics.py`のargparseにフィルタリングオプションを追加し、フィルタ条件に基づいてデータを絞り込み集計する。 